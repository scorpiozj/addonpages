<!DOCTYPE html>
<html lang="english">
<head>
        <title> 
UINavigationController add Child View Controller UINavigationController正确添加子View Controller 
</title>
        <meta charset="utf-8" />
<meta name="description" content ="如何正确地使用UINavigationController添加子视图控制器; correctly add child view controller with UINavigationController;">
 
        <!-- <meta name="description" content="a blog site for tech: AI,iOS,Swift,OS X; 个人技术网站交流: 人工智能,iOS,Swift,OS X 等"> -->


        <!-- Mobile viewport optimized: j.mp/bplateviewport -->
        <meta name="viewport" content="width=device-width,initial-scale=1, maximum-scale=1">

        <link rel="stylesheet" type="text/css" href="/theme/gumby.css" />
        <link rel="stylesheet" type="text/css" href="/theme/style.css" />
        <link rel="stylesheet" type="text/css" href="/theme/pygment.css" />

        <script src="/theme/js/libs/modernizr-2.6.2.min.js"></script>

        <!-- OpenGraph protocol tags: http://ogp.me/ -->
        <!-- originally adopted to be used for: https://blog.kmonsoor.com -->
        <meta property="og:site_name" content="App Gallery" />
        <meta property="og:type" content="article" />
    
        <meta property="og:title" content="UINavigationController add Child View Controller -- " />
        <meta property="og:url" content="/uinavigationcontroller-add-child-view-controller.html" />
        <meta property="og:description" content="correctly add child view controller with UINavigationController;" />

        <meta property="article:published_time" content="2019-11-13 21:30:00+08:00" />
        <!-- End of OpenGraph protocol tags -->

        <!-- Added for SEO -->
        <link rel="canonical" href="/uinavigationcontroller-add-child-view-controller.html"/>

            <meta name="keywords" content = "iOS,iPhone,UINavigationController, addChild;"/>
        


        <link rel="shortcut icon" href="/imgs/favicon.ico">
        <link rel="icon" sizes="16x16 32x32 64x64" href="/imgs/favicon.ico">
        <link rel="icon" type="image/png" sizes="196x196" href="/imgs/favicon-192.png">
        <link rel="icon" type="image/png" sizes="160x160" href="/imgs/favicon-160.png">
        <link rel="icon" type="image/png" sizes="96x96" href="/imgs/favicon-96.png">
        <link rel="icon" type="image/png" sizes="64x64" href="/imgs/favicon-64.png">
        <link rel="icon" type="image/png" sizes="32x32" href="/imgs/favicon-32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/imgs/favicon-16.png">
        <link rel="apple-touch-icon" href="/imgs/favicon-57.png">
        <link rel="apple-touch-icon" sizes="114x114" href="/imgs/favicon-114.png">
        <link rel="apple-touch-icon" sizes="72x72" href="/imgs/favicon-72.png">
        <link rel="apple-touch-icon" sizes="144x144" href="/imgs/favicon-144.png">
        <link rel="apple-touch-icon" sizes="60x60" href="/imgs/favicon-60.png">
        <link rel="apple-touch-icon" sizes="120x120" href="/imgs/favicon-120.png">
        <link rel="apple-touch-icon" sizes="76x76" href="/imgs/favicon-76.png">
        <link rel="apple-touch-icon" sizes="152x152" href="/imgs/favicon-152.png">
        <link rel="apple-touch-icon" sizes="180x180" href="/imgs/favicon-180.png">
        <meta name="msapplication-TileColor" content="#FFFFFF">
        <meta name="msapplication-TileImage" content="/imgs/favicon-144.png">
        <meta name="msapplication-config" content="/browserconfig.xml">




        <!-- /Global site tag (gtag.js) - Google Analytics  https-->
        <!-- <script async src="https://www.googletagmanager.com/gtag/js?id=UA-42655308-5"></script> -->
        <!-- <script>
          window.dataLayer = window.dataLayer || [];
          function gtag(){dataLayer.push(arguments);}
          gtag('js', new Date());

          gtag('config', 'UA-42655308-5');
        </script> -->
        <!-- / http -->
        <!-- <script>
          (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
          (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
          })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

          ga('create', 'UA-42655308-4', 'auto');
          ga('send', 'pageview');
        </script> -->

</head>

<body id="index" class="home">


    <div class="container">

        <div class="row">

          <header id="banner" class="body">
                  <h1><a href="/">App Gallery <strong></strong></a></h1>
          </header><!-- /#banner -->

            <div id="navigation" class="navbar row">
              <a href="#" gumby-trigger="#navigation &gt; ul" class="toggle"><i class="icon-menu"></i></a>
             
              <ul class="columns">
                <li><a href="/">Home</a></li>


              </ul>
            </div>


<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BlogPosting",
  "name": "UINavigationController add Child View Controller",
  "headline": "UINavigationController add Child View Controller",
  "datePublished": "2019-11-13 21:30:00+08:00",
  "dateModified": "",
  "author": {
    "@type": "Person",
    "name": "Charles Zhu",
    "url": "/author/charles-zhu.html"
  },
  "keywords": "[]",
  "publisher":{
    "@type": "Organization",
    "name": "App Gallery",
    "url": "",
    "logo": {
      "@type": "ImageObject",
      "url": ""
    }
  },
  "image": "",
  "url": "/uinavigationcontroller-add-child-view-controller.html",
  "description": "correctly add child view controller with UINavigationController;"
}
</script>

<section id="content" class="body">
   <div class="row">
        <div class="eleven columns">


            <header>
              <h2 class="entry-title">
          <a href="/uinavigationcontroller-add-child-view-controller.html" rel="bookmark" title="Permalink to UINavigationController add Child View Controller">
 UINavigationController正确添加子View Controller           </a>
        </h2>
 
            </header>
            <footer class="post-info">
              <abbr class="published" title="2019-11-13T21:30:00+08:00">
                Wed 13 November 2019
              </abbr>
        <address class="vcard author">
          By
          <a class="url fn" href="/author/charles-zhu.html">Charles Zhu</a>
              </address>
      </footer>
      <!-- /.post-info -->
            <div class="entry-content">
              <h2>问题产生</h2>
<p>最近，在集成一个全屏广告页的时候，遇到视图控制器的生命周期异常的问题：除了viewDidLoad，其余函数都没有执行。广告页本身是一个 AdsVC，当某个页面需要展示全屏广告的时候，将自己作为参数传递给 AdsVC。在 AdsVC 中，会把调用者作为一个 container controller，进行页面的添加。<br>
对于普通的 view controller，这样处理没有问题。但是，当如 UINavigationController 的 VC 调用的时候，会发生 AdsVC 的生命周期异常的问题。</p>
<h2>原因和解决</h2>
<p>基本确定 UINavigationController 作为 iOS 原生的 container controller，对 child controller 的添加/移除有内部的实现，从而导致 appear 相关的函数没有执行。<br>
通过查看头文件，可以发现：</p>
<div class="highlight"><pre><span></span><span class="nv">Discussion</span>
<span class="k">If</span> <span class="nv">you</span> <span class="nv">are</span> <span class="nv">implementing</span> <span class="nv">a</span> <span class="nv">custom</span> <span class="nv">container</span> <span class="nv">controller</span>, <span class="nv">use</span> <span class="nv">this</span> <span class="nv">method</span> <span class="nv">to</span> <span class="nv">tell</span> <span class="nv">the</span> <span class="nv">child</span> <span class="nv">that</span> <span class="nv">its</span> <span class="nv">views</span> <span class="nv">are</span> <span class="nv">about</span> <span class="nv">to</span> <span class="nv">appear</span> <span class="nv">or</span> <span class="nv">disappear</span>. <span class="k">Do</span> <span class="nv">not</span> <span class="nv">invoke</span> <span class="nv">viewWillAppear</span><span class="ss">(</span><span class="nv">_</span>:<span class="ss">)</span>, <span class="nv">viewWillDisappear</span><span class="ss">(</span><span class="nv">_</span>:<span class="ss">)</span>, <span class="nv">viewDidAppear</span><span class="ss">(</span><span class="nv">_</span>:<span class="ss">)</span>, <span class="nv">or</span> <span class="nv">viewDidDisappear</span><span class="ss">(</span><span class="nv">_</span>:<span class="ss">)</span> <span class="nv">directly</span>.

<span class="nv">func</span> <span class="nv">beginAppearanceTransition</span><span class="ss">(</span><span class="nv">_</span> <span class="nv">isAppearing</span>: <span class="nv">Bool</span>, <span class="nv">animated</span>: <span class="nv">Bool</span><span class="ss">)</span>
</pre></div>


<p>于是，解决方法就是调用 AppearanceTransition 相关的函数，如下：</p>
<div class="highlight"><pre><span></span><span class="nv">open</span> <span class="nv">func</span> <span class="nv">showIn</span><span class="ss">(</span><span class="nv">_</span> <span class="nv">viewController</span>: <span class="nv">UIViewController</span><span class="ss">)</span>{
        <span class="nv">viewController</span>.<span class="nv">addChild</span><span class="ss">(</span><span class="nv">self</span><span class="ss">)</span>
        <span class="nv">self</span>.<span class="nv">view</span>.<span class="nv">frame</span> <span class="o">=</span> <span class="nv">viewController</span>.<span class="nv">view</span>.<span class="nv">bounds</span>
        <span class="k">if</span> <span class="nv">viewController</span> <span class="nv">is</span> <span class="nv">UINavigationController</span> {
            <span class="nv">self</span>.<span class="nv">beginAppearanceTransition</span><span class="ss">(</span><span class="nv">true</span>, <span class="nv">animated</span>: <span class="nv">true</span><span class="ss">)</span>
            <span class="nv">viewController</span>.<span class="nv">view</span>.<span class="nv">addSubview</span><span class="ss">(</span><span class="nv">self</span>.<span class="nv">view</span><span class="ss">)</span>
            <span class="nv">self</span>.<span class="nv">view</span>.<span class="nv">alpha</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="nv">UIView</span>.<span class="nv">animate</span><span class="ss">(</span><span class="nv">withDuration</span>: <span class="mi">0</span>.<span class="mi">2</span>, <span class="nv">animations</span>: {
                <span class="nv">self</span>.<span class="nv">view</span>.<span class="nv">alpha</span> <span class="o">=</span> <span class="mi">1</span>
            }<span class="ss">)</span> { <span class="ss">(</span><span class="nv">_</span><span class="ss">)</span> <span class="nv">in</span>
                <span class="nv">self</span>.<span class="nv">endAppearanceTransition</span><span class="ss">()</span>
                <span class="nv">self</span>.<span class="nv">didMove</span><span class="ss">(</span><span class="nv">toParent</span>: <span class="nv">viewController</span><span class="ss">)</span>
            }
        }<span class="k">else</span> {
            <span class="nv">viewController</span>.<span class="nv">view</span>.<span class="nv">addSubview</span><span class="ss">(</span><span class="nv">self</span>.<span class="nv">view</span><span class="ss">)</span>
            <span class="nv">self</span>.<span class="nv">didMove</span><span class="ss">(</span><span class="nv">toParent</span>: <span class="nv">viewController</span><span class="ss">)</span>
        }  
    }
    <span class="nv">open</span> <span class="nv">func</span> <span class="nv">removeFrom</span><span class="ss">(</span><span class="nv">_</span> <span class="nv">viewController</span>: <span class="nv">UIViewController</span><span class="ss">)</span>{
        <span class="k">if</span> <span class="nv">viewController</span>.<span class="nv">view</span>.<span class="nv">subviews</span>.<span class="nv">contains</span><span class="ss">(</span><span class="nv">self</span>.<span class="nv">view</span><span class="ss">)</span> {
            <span class="k">if</span> <span class="nv">viewController</span> <span class="nv">is</span> <span class="nv">UINavigationController</span> {
                <span class="nv">self</span>.<span class="nv">willMove</span><span class="ss">(</span><span class="nv">toParent</span>: <span class="nv">nil</span><span class="ss">)</span>
                <span class="nv">self</span>.<span class="nv">beginAppearanceTransition</span><span class="ss">(</span><span class="nv">false</span>, <span class="nv">animated</span>: <span class="nv">true</span><span class="ss">)</span>
                <span class="nv">UIView</span>.<span class="nv">animate</span><span class="ss">(</span><span class="nv">withDuration</span>: <span class="mi">0</span>.<span class="mi">2</span>, <span class="nv">animations</span>: {
                    <span class="nv">self</span>.<span class="nv">view</span>.<span class="nv">alpha</span> <span class="o">=</span> <span class="mi">0</span>
                }<span class="ss">)</span> { <span class="ss">(</span><span class="nv">_</span><span class="ss">)</span> <span class="nv">in</span>
                    <span class="nv">self</span>.<span class="nv">view</span>.<span class="nv">removeFromSuperview</span><span class="ss">()</span>
                    <span class="nv">self</span>.<span class="nv">endAppearanceTransition</span><span class="ss">()</span>
                    <span class="nv">self</span>.<span class="nv">removeFromParent</span><span class="ss">()</span>
                }
            }<span class="k">else</span> {
                <span class="nv">self</span>.<span class="nv">view</span>.<span class="nv">removeFromSuperview</span><span class="ss">()</span>
                <span class="nv">self</span>.<span class="nv">removeFromParent</span><span class="ss">()</span>
            }
        }
    }
</pre></div>
      </div>
      <!-- /.entry-content -->

      <!-- Neighbor -->
      <div class="pagination">
        <ul>
          <li class="prev">
            <a href="/">← Previous</a>
          </li>
           <li class="next">
            <a href="/">Next →</a>
          </li>
        </ul>
      </div>

    </div>
    <!-- /.eleven.columns -->
<div class="three columns">

  <h4>Pages</h4>

  <ul>

  




<nav class="widget">
  <h4>Social</h4>
  <ul class="blank">
    <li><a href="#">You can add links in your config file</a></li>
    <li><a href="#">Another social link</a></li>
  </ul>
</nav>

</div>  </div>
  <!-- /.row -->
</section>

       </div><!-- /.row -->
    </div><!-- /.container -->


       <div class="container.nopad bg">

    
        <footer id="credits" class="row">
          <div class="seven columns left-center">

                   <address id="about" class="vcard body">
                    Proudly powered by <a href="http://getpelican.com/">Pelican</a>,
                    which takes great advantage of <a href="http://python.org">Python</a>.
                    
                    Based on the <a target="_blank" href="http://gumbyframework.com">Gumby Framework</a><br>
                    <div align="center"><a href='http://www.beian.miit.gov.cn/'>待审核后添加</a></div>
                    <div align="center"><a href='http://www.beian.miit.gov.cn/'>工信部备案管理系统</a></div>
                    </address>
          </div>


          <div class="seven columns">
            <div class="row">
              <ul class="socbtns">





              </ul>
            </div>
          </div>
        </footer>

    </div>


  <script src="/theme/js/libs/jquery-1.9.1.min.js"></script>
  <script src="/theme/js/libs/gumby.min.js"></script>
  <script src="/theme/js/plugins.js"></script>
<!--   // <script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1265396808'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s13.cnzz.com/z_stat.php%3Fid%3D1265396808%26show%3Dpic' type='text/javascript'%3E%3C/script%3E"));</script>
 -->
</body>
</html>